# 飞书多维表格 AI 插件使用说明

## 功能介绍

这个插件可以让你使用 OpenRouter 的 AI 模型批量处理飞书多维表格中的数据。

## 使用步骤

### 1. 准备工作

- 获取 API Key（目前支持 OpenRouter，访问 https://openrouter.ai）
- 在飞书多维表格中准备好数据：
  - 创建一个或多个文本字段用于存放用户提示词（user prompt）
  - 创建一个或多个文本字段用于存放 AI 处理结果

### 2. 配置插件

1. **选择表格**：选择要处理的多维表格
2. **选择 AI Provider**：选择 AI 服务提供商（目前支持 OpenRouter）
   - 切换 Provider 时会自动加载对应的 API Key
   - 每个 Provider 的 API Key 独立保存
3. **输入 API Key**：填入你的 API Key
   - 输入后会自动加载可用的模型列表
   - API Key 会按 Provider 分别保存，下次打开时无需重新输入
   - 点击眼睛图标可以切换 API Key 的显示/隐藏状态
   - 清空输入框会删除保存的 API Key
4. **系统提示词**：输入 AI 模型的系统提示词，用于定义 AI 的行为和角色
5. **选择模型**：从动态加载的模型列表中选择要使用的 AI 模型
   - 支持搜索功能，可以通过键盘输入快速过滤模型
   - 显示每百万 token 的价格（格式：$X.XX/$Y.YY/M）
6. **用户提示词字段**：选择包含用户提示词的字段（可多选，内容会自动拼接）
7. **结果字段**：选择用于存储结果的字段（可多选）
8. **Temperature**：控制生成内容的创造性（0-2，默认为0）
   - 0：确定性输出，模型总是选择概率最高的词
   - 较低值（0.1-0.5）：更保守、更一致的输出
   - 中等值（0.5-1.5）：平衡创造性和一致性
   - 较高值（1.5-2）：更有创造性、更多样化的输出
9. **Top P**：控制生成内容的多样性（0-1，默认为0）
   - 0：配合 Temperature=0 使用时，产生最确定的输出
   - 较低值（0.1-0.5）：限制模型只使用最可能的词汇
   - 中等值（0.5-0.9）：平衡的词汇选择
   - 较高值（0.9-1）：允许模型使用更多样化的词汇

### 3. 开始处理

点击"Start Processing"按钮，插件会：
- 逐行读取表格数据
- 从选定的多个字段中提取并拼接用户提示词内容
- 检查选定的结果字段是否为空
- 只对空字段调用 OpenRouter API 进行处理
- 将结果写回到空的字段中（已有内容的字段会跳过）
- **并发处理**：同时处理最多 20 条记录，提高处理效率
- 显示实时处理进度

## 注意事项

1. **API 费用**：使用 OpenRouter API 会产生费用，请注意控制使用量
2. **处理速度**：
   - 采用并发处理，最多同时处理 20 条记录
   - 总体速度取决于记录数量和 API 响应速度
   - 并发处理大幅提升了批量数据的处理效率
3. **错误处理**：如果某条记录处理失败，会在结果中显示错误信息，不影响其他记录的处理
4. **字段类型**：只支持文本类型的字段作为输入和输出
5. **智能处理**：插件会智能跳过已有内容的字段，避免重复处理和费用浪费
6. **批量处理**：可以选择多个结果字段，每个空字段都会独立调用 API 获取结果
7. **多字段拼接**：选择多个用户提示词字段时，内容会直接拼接在一起
8. **API Key 安全**：API Key 按 Provider 分别保存在你的浏览器本地存储中，不会上传到任何服务器
9. **并发安全**：并发处理时确保每条记录的输入和输出严格对应，不会出现数据混乱

## 支持的模型

插件会根据你的 API Key 动态加载所有可用的模型。OpenRouter 支持多种模型，包括但不限于：
- OpenAI (GPT-4, GPT-3.5 等)
- Anthropic (Claude 系列)
- Google (Gemini 系列)
- Meta (Llama 系列)
- 以及更多开源模型

模型列表会显示每个模型的名称和价格信息，方便你选择合适的模型。