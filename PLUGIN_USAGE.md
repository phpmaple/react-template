# 飞书多维表格 AI 插件使用说明

## 功能介绍

这个插件可以让你使用多种 AI 服务提供商的模型批量处理飞书多维表格中的数据。支持两种数据处理模式：分离式模式和消息格式模式。

## 使用步骤

### 1. 准备工作

- 获取 API Key：
  
- 在飞书多维表格中准备好数据：
  - **分离式模式**：创建字段用于存放用户提示词（user prompt）和结果
  - **消息格式模式**：创建字段存放完整的 messages 数组和结果

### 2. 配置插件

1. **选择表格**：选择要处理的多维表格

2. **选择数据模式**：
   - **Separated（分离式）**：传统模式，分别设置 System Prompt 和 User Prompt 字段
   - **Messages（消息格式）**：使用包含完整对话历史的 messages 字段

3. **选择 AI Provider**：选择 AI 服务提供商
   - **OpenRouter**：支持多种开源和商业模型
   - **Doubao（豆包）**：字节跳动的 AI 模型服务
   - 切换 Provider 时会自动加载对应的 API Key
   - 每个 Provider 的 API Key 独立保存

4. **输入 API Key**：填入你的 API Key
   - 输入后会自动加载可用的模型列表
   - API Key 会按 Provider 分别保存，下次打开时无需重新输入
   - 点击眼睛图标可以切换 API Key 的显示/隐藏状态
   - 清空输入框会删除保存的 API Key

#### 分离式模式配置：
5. **系统提示词**：输入 AI 模型的系统提示词，用于定义 AI 的行为和角色
6. **选择模型**：从动态加载的模型列表中选择要使用的 AI 模型
   - 支持搜索功能，可以通过键盘输入快速过滤模型
7. **用户提示词字段**：选择包含用户提示词的字段（可多选，内容会自动拼接）
8. **结果字段**：选择用于存储结果的字段（可多选）

#### 消息格式模式配置：
5. **选择模型**：从动态加载的模型列表中选择要使用的 AI 模型
6. **Messages 字段**：选择包含完整 messages 数组的字段
   - 字段内容应为 JSON 格式：`[{"role":"system","content":"..."},{"role":"user","content":"..."}]`
7. **结果字段**：选择用于存储结果的字段（可多选）

#### 高级参数：
8. **Temperature**：控制生成内容的创造性（0-2，默认为0）
   - 0：确定性输出，模型总是选择概率最高的词
   - 较低值（0.1-0.5）：更保守、更一致的输出
   - 中等值（0.5-1.5）：平衡创造性和一致性
   - 较高值（1.5-2）：更有创造性、更多样化的输出
9. **Top P**：控制生成内容的多样性（0-1，默认为0）
   - 0：配合 Temperature=0 使用时，产生最确定的输出
   - 较低值（0.1-0.5）：限制模型只使用最可能的词汇
   - 中等值（0.5-0.9）：平衡的词汇选择
   - 较高值（0.9-1）：允许模型使用更多样化的词汇

### 3. 开始处理

点击"Start Processing"按钮，插件会：
- 逐行读取表格数据
- 根据选择的模式处理数据：
  - **分离式模式**：从选定的多个字段中提取并拼接用户提示词内容，与系统提示词组合
  - **消息格式模式**：解析 messages 字段中的 JSON 数据，直接发送给 AI API
- 检查选定的结果字段是否为空
- 只对空字段调用 AI API 进行处理
- 将结果写回到空的字段中（已有内容的字段会跳过）
- **并发处理**：同时处理最多 20 条记录，提高处理效率
- 显示实时处理进度

## 支持的模型

插件会根据你的 API Key 动态加载所有可用的模型。

### OpenRouter 支持的模型
OpenRouter 支持多种模型，包括但不限于：
- OpenAI (GPT-4, GPT-3.5 等)
- Anthropic (Claude 系列)
- Google (Gemini 系列)
- Meta (Llama 系列)
- 以及更多开源模型

模型列表会显示每个模型的名称和价格信息，方便你选择合适的模型。

### Doubao（豆包）支持的模型
豆包提供多种模型，包括：
- **Doubao-Seed-1.6-thinking** - 最新的思维链模型
- **Doubao-Seed-1.6** - 标准对话模型
- **Doubao-Seed-1.6-flash** - 快速响应模型
- **Doubao-1.5-thinking-vision-pro** - 支持视觉的思维链模型
- **Doubao-1.5-vision-pro** - 视觉理解模型
- **Doubao-pro-256k** - 长上下文模型（256k tokens）
- **Doubao-pro-128k** - 长上下文模型（128k tokens）
- **Doubao-pro-32k** - 标准上下文模型
- **Doubao-lite** 系列 - 轻量级模型，适合快速处理

### Messages 格式示例
消息格式模式支持标准的 ChatGPT 消息格式：
[
  {
    "role": "system",
    "content": "你是一个有用的AI助手..."
  },
  {
    "role": "user", 
    "content": "用户的问题或输入"
  },
  {
    "role": "assistant",
    "content": "之前的AI回复（可选）"
  }
]